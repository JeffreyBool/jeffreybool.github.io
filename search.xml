<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>golangè·å–æ–‡ç« æ‘˜è¦ç®—æ³•æ€§èƒ½è¯¦ç»†å¯¹æ¯”</title>
      <link href="/2020/06/05/golang-huo-qu-wen-zhang-zhai-yao-suan-fa-xing-neng-xiang-xi-dui-bi/"/>
      <url>/2020/06/05/golang-huo-qu-wen-zhang-zhai-yao-suan-fa-xing-neng-xiang-xi-dui-bi/</url>
      
        <content type="html"><![CDATA[<p>ä¸ºäº†æµ‹è¯• golang <code>ioutil.ReadAll</code> ã€<code>io.Copy</code>ã€<code>bufio.NewReader</code> æ€§èƒ½ æˆ‘å†™äº†ä¸‰ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä»£ç å¦‚ä¸‹:</p><h2 id="golang-è¯»å–æ–‡ä»¶æ€§èƒ½å¯¹æ¯”"><a href="#golang-è¯»å–æ–‡ä»¶æ€§èƒ½å¯¹æ¯”" class="headerlink" title="golang è¯»å–æ–‡ä»¶æ€§èƒ½å¯¹æ¯”"></a>golang è¯»å–æ–‡ä»¶æ€§èƒ½å¯¹æ¯”</h2><h3 id="ioutil-ReadAll"><a href="#ioutil-ReadAll" class="headerlink" title="ioutil.ReadAll"></a><code>ioutil.ReadAll</code></h3><pre class=" language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">ReadAll</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileMD5 <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> err    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> err    <span class="token punctuation">}</span>    hash <span class="token operator">:=</span> sha1<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    hash<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>    fileMD5 <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span></code></pre><h3 id="io-copy"><a href="#io-copy" class="headerlink" title="io.copy"></a><code>io.copy</code></h3><pre class=" language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Copy</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileMD5 <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> err    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    md5hash <span class="token operator">:=</span> sha1<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>md5hash<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> err    <span class="token punctuation">}</span>    fileMD5 <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>md5hash<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span></code></pre><h3 id="bufio-NewReader"><a href="#bufio-NewReader" class="headerlink" title="bufio.NewReader"></a><code>bufio.NewReader</code></h3><pre class=" language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">ReadBuf</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileMD5 <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> err    <span class="token punctuation">}</span>    <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>    reader <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>    md5hash <span class="token operator">:=</span> sha1<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">{</span>        n<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// é‡åˆ°ä»»ä½•é”™è¯¯ç«‹å³è¿”å›ï¼Œå¹¶å¿½ç•¥ EOF é”™è¯¯ä¿¡æ¯</span>            <span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span>                <span class="token keyword">goto</span> stop            <span class="token punctuation">}</span>            <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> err        <span class="token punctuation">}</span>        md5hash<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>stop<span class="token punctuation">:</span>    fileMD5 <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>md5hash<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> fileMD5<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span></code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre class=" language-go"><code class="language-go"><span class="token keyword">package</span> file_test<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"testing"</span>    <span class="token string">"filestore/test/file"</span><span class="token punctuation">)</span><span class="token keyword">var</span> <span class="token punctuation">(</span>    minPath <span class="token operator">=</span> <span class="token string">"~/6d827d1edddea7c73fb7d6efbb467167839ff2f6.jpg"</span>    maxPath <span class="token operator">=</span> <span class="token string">"/Users/zhanggaoyuan/å­¦ä¹ /2004.mkv"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">BenchmarkReadAll</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> file<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>minPath<span class="token punctuation">)</span>        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            b<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">BenchmarkCopy</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> file<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>minPath<span class="token punctuation">)</span>        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            b<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">BenchmarkReadBuf</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> file<span class="token punctuation">.</span><span class="token function">ReadBuf</span><span class="token punctuation">(</span>minPath<span class="token punctuation">)</span>        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>            b<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æ–‡ä»¶å¤§å°è€—æ—¶æƒ…å†µ"><a href="#æ–‡ä»¶å¤§å°è€—æ—¶æƒ…å†µ" class="headerlink" title="æ–‡ä»¶å¤§å°è€—æ—¶æƒ…å†µ"></a>æ–‡ä»¶å¤§å°è€—æ—¶æƒ…å†µ</h2><h3 id="å°äºç­‰äº-10MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"><a href="#å°äºç­‰äº-10MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ" class="headerlink" title="å°äºç­‰äº 10MB çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"></a>å°äºç­‰äº <code>10MB</code> çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ</h3><p>å‡†å¤‡ 6d827d1edddea7c73fb7d6efbb467167839ff2f6.jpg 9.7M çš„æ–‡ä»¶ï¼Œ</p><p>æ‰§è¡Œ <code>go test -bench=. -benchmem</code> å°±å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„ä¿¡æ¯å•¦</p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkReadAll-8             64      17963784 ns/op    33552812 B/op          22 allocs/opBenchmarkCopy-8                80      12910267 ns/op       33192 B/op           8 allocs/opBenchmarkReadBuf-8             66      15641888 ns/op        5544 B/op           9 allocs/opPASSok      filestore/test/file    3.994s</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡º <code>BenchmarkCopy</code> æ€§èƒ½æœ€é«˜ï¼Œæ‰§è¡Œ 84 æ¬¡å¹³å‡æ—¶é—´ 12910267 çº³ç§’ï¼Œä¹Ÿå°±æ˜¯ 1.2 ç§’å·¦å³çš„æ ·å­å•¦ã€‚</p><h3 id="å°äºç­‰äº-40MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"><a href="#å°äºç­‰äº-40MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ" class="headerlink" title="å°äºç­‰äº 40MB çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"></a>å°äºç­‰äº <code>40MB</code> çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ</h3><p>å‡†å¤‡æ–‡ä»¶ niushop_b2c_mf2.3.zip 37M</p><p>æ‰§è¡Œ <code>go test -bench=. -benchmem</code> å°±å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„ä¿¡æ¯å•¦</p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkReadAll-8             16      63298080 ns/op    134216088 B/op          24 allocs/opBenchmarkCopy-8                24      48085580 ns/op       33176 B/op           8 allocs/opBenchmarkReadBuf-8             19      58120592 ns/op        5528 B/op           9 allocs/opPASSok      filestore/test/file    4.206s</code></pre><p>æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥çœ‹åˆ° <code>BenchmarkCopy</code> å‡½æ•°æ€§èƒ½æœ€é«˜</p><h3 id="å¤§äºç­‰äº-1G-å°äºç­‰äº-6Gçš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"><a href="#å¤§äºç­‰äº-1G-å°äºç­‰äº-6Gçš„æ–‡ä»¶è€—æ—¶æƒ…å†µ" class="headerlink" title="å¤§äºç­‰äº 1G å°äºç­‰äº 6Gçš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"></a>å¤§äºç­‰äº <code>1G</code> å°äºç­‰äº <code>6G</code>çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ</h3><p>æ³¨æ„ä¸€ç‚¹çš„å°±æ˜¯å½“æˆ‘ä»¬æµ‹è¯•å¤§æ–‡ä»¶è¯»å–ä¸èƒ½ç›´æ¥ä½¿ç”¨ <code>ioutil.ReadAll</code>, å› ä¸ºè¿™ä¸ªå‡½æ•°ä¼šç›´æ¥æŠŠæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·ä¼šå¯¼è‡´å†…å­˜ç›´æ¥å´©æºƒã€‚æˆ‘ä»¬åªä½¿ç”¨ <code>io.copy</code> å’Œ bufio.NewReader å‡½æ•°ï¼Œå¤ªå¤§äº†åˆšä¸ä½ï¼Œæˆ‘ä¹Ÿå¾ˆæ— å¥ˆå•Š~~ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†</p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkCopy-8                 1    8612443012 ns/op       33176 B/op          10 allocs/opBenchmarkReadBuf-8              1    8924705447 ns/op        5512 B/op           9 allocs/opPASSok      filestore/test/file    17.554s</code></pre><p>æˆ‘ä»¬æ¯”è¾ƒè¿™ä¸¤ä¸ªå‡½æ•°çš„æ€§èƒ½å‘ç°å…·ä½“å·®åˆ«ä¸æ˜¯å¤ªå¤§ã€‚ å•è¿˜æ˜¯ <code>BenchmarkCopy</code> æ€§èƒ½æ›´å¿«ã€‚ã€‚ã€‚ï¼Œå¥½å•¦æ²¡å¾—è¯è¯´é€‰ <code>io.copy</code> å•¦</p><h2 id="æ¥ä¸‹æ¥åˆ†æ-md5-å’Œ-sha1-å“ªä¸ªç®—æ³•è®¡ç®—æ›´å¿«"><a href="#æ¥ä¸‹æ¥åˆ†æ-md5-å’Œ-sha1-å“ªä¸ªç®—æ³•è®¡ç®—æ›´å¿«" class="headerlink" title="æ¥ä¸‹æ¥åˆ†æ md5 å’Œ sha1 å“ªä¸ªç®—æ³•è®¡ç®—æ›´å¿«"></a>æ¥ä¸‹æ¥åˆ†æ <code>md5</code> å’Œ <code>sha1</code> å“ªä¸ªç®—æ³•è®¡ç®—æ›´å¿«</h2><p>æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸åŒçš„æ–‡ä»¶åšæ¯”è¾ƒï¼Œå› ä¸ºæœ‰æ—¶å€™å¾ˆå¤šå‡½æ•°çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦å’Œå¤§å°ï¼Œæ•°é‡æœ‰å…³ç³»</p><h3 id="å°äºç­‰äº10MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"><a href="#å°äºç­‰äº10MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ" class="headerlink" title="å°äºç­‰äº10MB çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"></a>å°äºç­‰äº<code>10MB</code> çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ</h3><p><code>sha1</code></p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkReadAll-8             64      17963784 ns/op    33552812 B/op          22 allocs/opBenchmarkCopy-8                80      12910267 ns/op       33192 B/op           8 allocs/opBenchmarkReadBuf-8             66      15641888 ns/op        5544 B/op           9 allocs/opPASSok      filestore/test/file    3.994s</code></pre><p><code>md5</code></p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkReadAll-8             56      20431688 ns/op    33552750 B/op          22 allocs/opBenchmarkCopy-8                70      16554352 ns/op       33128 B/op           8 allocs/opBenchmarkReadBuf-8             57      19220965 ns/op        5480 B/op           9 allocs/opPASSok      filestore/test/file    4.202s</code></pre><h3 id="å°äºç­‰äº-40MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ-1"><a href="#å°äºç­‰äº-40MB-çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ-1" class="headerlink" title="å°äºç­‰äº 40MB çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"></a>å°äºç­‰äº <code>40MB</code> çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ</h3><p><code>sha1</code></p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkReadAll-8             16      63298080 ns/op    134216088 B/op          24 allocs/opBenchmarkCopy-8                24      48085580 ns/op       33176 B/op           8 allocs/opBenchmarkReadBuf-8             19      58120592 ns/op        5528 B/op           9 allocs/opPASSok      filestore/test/file    4.206s</code></pre><p><code>md5</code></p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkReadAll-8             14      75987790 ns/op    134216024 B/op          24 allocs/opBenchmarkCopy-8                19      61600369 ns/op       33112 B/op           8 allocs/opBenchmarkReadBuf-8             15      72338837 ns/op        5464 B/op           9 allocs/opPASSok      filestore/test/file    4.339s</code></pre><h3 id="å¤§äºç­‰äº-1G-å°äºç­‰äº-6Gçš„æ–‡ä»¶è€—æ—¶æƒ…å†µ-1"><a href="#å¤§äºç­‰äº-1G-å°äºç­‰äº-6Gçš„æ–‡ä»¶è€—æ—¶æƒ…å†µ-1" class="headerlink" title="å¤§äºç­‰äº 1G å°äºç­‰äº 6Gçš„æ–‡ä»¶è€—æ—¶æƒ…å†µ"></a>å¤§äºç­‰äº <code>1G</code> å°äºç­‰äº <code>6G</code>çš„æ–‡ä»¶è€—æ—¶æƒ…å†µ</h3><p><code>sha1</code></p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkCopy-8                 1    8612443012 ns/op       33176 B/op          10 allocs/opBenchmarkReadBuf-8              1    8924705447 ns/op        5512 B/op           9 allocs/opPASSok      filestore/test/file    17.554s</code></pre><p><code>md5</code></p><pre><code>goos: darwingoarch: amd64pkg: filestore/test/fileBenchmarkCopy-8                 1    8714197367 ns/op       33112 B/op          10 allocs/opBenchmarkReadBuf-8              1    10077543682 ns/op        5448 B/op           9 allocs/opPASSok      filestore/test/file    18.804s</code></pre><blockquote><p>æœ€ç»ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>sha1</code> ç®—æ³•ä¸ç®¡æ˜¯å¤§æ–‡ä»¶è¿˜æ˜¯å°æ–‡ä»¶éƒ½ä¼˜äº <code>md5</code> æ–‡ä»¶çš„æ€§èƒ½ã€‚è‡³æ­¤è¿˜ç”¨æ¯”å—ï¼Ÿå‚»å­æ‰ä¸é€‰ <code>sha1</code> ç®—æ³•å‘¢~, æœ€ç»ˆé€‰ <code>io.copy</code> å’Œ <code>sha1</code></p></blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.zhanggaoyuan.com/article/58" target="_blank" rel="noopener">https://www.zhanggaoyuan.com/article/58</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang é”è¯·å°å¿ƒä½¿ç”¨</title>
      <link href="/2020/06/05/golang-suo-qing-xiao-xin-shi-yong/"/>
      <url>/2020/06/05/golang-suo-qing-xiao-xin-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="å…³äºé”ä½¿ç”¨"><a href="#å…³äºé”ä½¿ç”¨" class="headerlink" title="å…³äºé”ä½¿ç”¨"></a>å…³äºé”ä½¿ç”¨</h2><p> å‡å°‘è¯»å†™é”ç²’åº¦å’ŒèŒƒå›´å¤§å°ï¼Œå°½å¯èƒ½å°½æ—©é‡Šæ”¾ï¼Œé”å’Œ <code>defer</code> é…åˆä½¿ç”¨å®¹æ˜“è¸©å‘ï¼Œå› ä¸ºä¼šå‡ºç°æ­»é”ï¼Œæ„æ€å°±æ˜¯ï¼Œè¿™æ®µä»£ç å¯èƒ½ä¼šé‡å¤åŠ é”ï¼Œè¿™ç§é—®é¢˜å¯èƒ½æ˜¯å¶å‘å¼•èµ·çš„ï¼Œæ‰€ä»¥å¾ˆéš¾æ’æŸ¥ã€‚</p><ol><li><p>æå‰ <code>unlock</code><br><img src="https://api.zhanggaoyuan.com/uploads/images/articles/202005/29/1_1590744022_k7ZtwmAx9H.png" alt="golang é”è¯·å°å¿ƒä½¿ç”¨"></p></li><li><p>ä¸èƒ½æå‰ <code>unlock</code> æ€ä¹ˆåŠï¼Ÿå¦‚ä½•å¤„ç†???<br><img src="https://api.zhanggaoyuan.com/uploads/images/articles/202005/29/1_1590744031_4Ay8Ub0Ntd.png" alt="golang é”è¯·å°å¿ƒä½¿ç”¨"><br><img src="https://api.zhanggaoyuan.com/uploads/images/articles/202005/29/1_1590744040_vMvix7i2KO.png" alt="golang é”è¯·å°å¿ƒä½¿ç”¨"><br><img src="https://api.zhanggaoyuan.com/uploads/images/articles/202005/29/1_1590744050_ewlAjsdhpx.png" alt="golang é”è¯·å°å¿ƒä½¿ç”¨"><br><img src="https://api.zhanggaoyuan.com/uploads/images/articles/202005/29/1_1590744056_VlDn6KYxy9.png" alt="golang é”è¯·å°å¿ƒä½¿ç”¨"></p></li></ol><p>ä»¥ä¸Šå°±æ˜¯å¤„ç†é”æå‰è¿”å›é˜²æ­¢å‘ï¼Œèƒ½å¤ŸçŸ¥é“é”ä»€ä¹ˆæ—¶é—´é‡Šæ”¾å¾ˆé‡è¦ï¼Œå¾€å¾€å¾ˆå¤šå‘å°±æ˜¯è¿™ä¸ªå‡½æ•°å·²ç» <code>lock</code> é”äº†ï¼Œç„¶åå†è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•° <code>a-&gt;b-&gt;c-&gt;d</code>ï¼Œ å¦‚æ­¤è°ƒç”¨é“¾ï¼›ä½ ä¸ä¼šçŸ¥é“è¿™äº›å‡½æ•°æ˜¯å¦ä¹Ÿè°ƒç”¨äº†è¿™ä¸ªå‡½æ•°çš„é”å®ä¾‹ï¼Œå¯¼è‡´æ­»é”çš„å‘ç”Ÿã€‚è€Œä¸”è¿˜æœ‰ä¸€ç‚¹ï¼Œåƒä¸Šå›¾çš„ <code>SendMessage</code> å¯èƒ½æ˜¯ä¸€ä¸ªè€—æ—¶è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±ä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œå¾—ä¸åˆ°é‡Šæ”¾ã€‚åƒæˆ‘é‡åˆ°çš„ä¸€ä¸ªå‘å°±æ˜¯è°ƒç”¨ <code>SendMessage</code> å‡½æ•°ï¼Œç„¶åè¿™ä¸ªå‡½æ•°ç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œç„¶åç”±äºå®¢æˆ·ç«¯ç§ç§åŸå› å¯¼è‡´æ¶ˆæ¯å‘é€å¤±è´¥è§¦å‘æˆ‘çš„ close å‡½æ•°ï¼Œç„¶å close å†…éƒ¨å¤„ç†èµ„æºæ¸…ç†å¯¼è‡´å†è°ƒç”¨è¿™ä¸ªé”å®ä¾‹çš„å‡½æ•°å¯¼è‡´é‡å¤åŠ é”ï¼Œè¿™ä¸ª ğŸ˜­ğŸ˜­<code>BUG</code> éšè—çš„å¾ˆæ·±ï¼Œä¸€èˆ¬çœ‹ä¸å‡ºæ¥ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.zhanggaoyuan.com/article/61" target="_blank" rel="noopener">https://www.zhanggaoyuan.com/article/61</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
